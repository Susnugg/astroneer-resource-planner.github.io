<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astroneer Resource Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base styles and fonts */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-image: url('https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/bg.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #d8f5ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }
        
        /* Define the fade-in animation for the container */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Define a fade-in for list items to appear sequentially */
        @keyframes listItemFadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .container {
            background-color: rgba(10, 34, 57, 0.8); /* Updated to a transparent color */
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            max-width: 950px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            border: 1px solid #176087;
            animation: fadeIn 0.8s ease-in-out forwards;
        }
        .scrollable-list, #resourceTotals {
            background-color: rgba(6, 26, 46, 0.7); /* Updated to match new theme */
            max-height: 50vh;
            overflow-y: auto;
            border: 1px solid #176087;
            border-radius: 0.75rem;
        }
        .item-card {
            background-color: rgba(12, 20, 37, 0.8); /* Updated to a transparent color */
            border-radius: 0.75rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            /* Smoother transition for all properties */
            transition: all 0.3s ease-in-out;
            border: 2px solid transparent;
        }
        .item-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 4px 20px rgba(83, 162, 190, 0.3);
            border-color: #53A2BE;
        }
        
        /* New: Add a satisfying "press" effect on click */
        .item-card:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(83, 162, 190, 0.5);
            transition: all 0.1s ease-out;
        }
        
        .item-card.selected {
            border-color: #53A2BE;
            background-color: #061a2e;
            box-shadow: 0 0 15px rgba(83, 162, 190, 0.7);
            transform: scale(1.01);
        }
        .item-icon {
            width: 48px;
            height: 48px;
            background-color: rgba(12, 20, 37, 0.8); /* Updated to transparent color */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            border: 1px solid #176087;
        }
        .item-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .resource-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .resource-list li {
            background-color: rgba(12, 20, 37, 0.8); /* Updated to a transparent color */
            border-radius: 0.5rem;
            padding: 0.75rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #176087;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease-in-out;
        }
        
        /* Animation for new items entering the resource list */
        @keyframes fadeInMoveIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .resource-list-item-enter {
            animation: fadeInMoveIn 0.5s ease-out forwards;
        }

        /* Animation for items leaving the resource list */
        @keyframes fadeOutMoveOut {
            from { opacity: 1; transform: translateX(0); height: auto; padding: 0.75rem 1.25rem; margin-bottom: 0.75rem; }
            to { opacity: 0; transform: translateX(20px); height: 0; padding: 0; margin: 0; }
        }
        .resource-list-item-exit {
            animation: fadeOutMoveOut 0.5s ease-in forwards;
        }

        .resource-icon {
            width: 32px;
            height: 32px;
            background-color: #1D84B5;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            overflow: hidden;
        }
        .resource-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .search-input {
            background-color: rgba(12, 20, 37, 0.8); /* Updated to a transparent color */
            border: 1px solid #176087;
            color: #d8f5ff;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            width: 100%;
            outline: none;
            /* Added smooth transition on input focus */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .search-input:focus {
            border-color: #53A2BE;
            box-shadow: 0 0 10px rgba(83, 162, 190, 0.5);
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quantity-input {
            background-color: rgba(12, 20, 37, 0.8); /* Updated to a transparent color */
            border: 1px solid #176087;
            color: #d8f5ff;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            width: 60px;
            text-align: center;
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .quantity-input::-webkit-inner-spin-button,
        .quantity-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="text-sky-100 p-8 flex items-center justify-center min-h-screen">

    <div class="container mx-auto p-8 rounded-3xl shadow-lg backdrop-filter backdrop-blur-sm bg-opacity-70">
        <!-- Title text instead of the logo image -->
        <div class="flex justify-center my-6">
            <img src="https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/logo.png" alt="Astroneer Logo" class="h-16">
        </div>

        <!-- Left Column: Item Selection -->
        <div class="flex flex-col md:flex-row gap-8">
            <div class="md:w-1/2">
                <h2 class="text-xl font-bold mb-4">Select Items to Craft</h2>
                <input type="text" id="searchInput" class="search-input mb-4" placeholder="Search for items...">
                <div class="scrollable-list p-4 rounded-xl overflow-y-scroll max-h-[50vh]">
                    <!-- Item list will be populated by JavaScript -->
                    <div id="itemList" class="flex flex-col gap-3"></div>
                </div>
            </div>

            <!-- Right Column: Resource Totals -->
            <div class="md:w-1/2">
                <h2 class="text-xl font-bold mb-4">Total Resources Required</h2>
                <div id="resourceTotals" class="p-6 rounded-xl">
                    <ul id="resourceList" class="resource-list">
                        <!-- Resource totals will be populated by JavaScript -->
                    </ul>
                    <p id="noSelectionMessage" class="text-center text-gray-500 mt-4">Select an item to see the resource breakdown.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // A comprehensive list of craftable items in Astroneer.
        // Data is organized by the printer required.
        const allItems = {
            "Backpack Printer": {
                "Tethers": {
                    icon: "https://i.imgur.com/k46M122.png",
                    recipe: { "Compound": 1 }
                },
                "Oxygen Filter": {
                    icon: "https://i.imgur.com/gK9qA5n.png",
                    recipe: { "Compound": 1 }
                },
                "Small Canister": {
                    icon: "https://i.imgur.com/c1oK0b2.png",
                    recipe: { "Resin": 1 }
                },
                "Small Battery": {
                    icon: "https://i.imgur.com/S8WJp6U.png",
                    recipe: { "Zinc": 1, "Lithium": 1 }
                },
                "Small Solar Panel": {
                    icon: "https://i.imgur.com/QhE3lHj.png",
                    recipe: { "Copper": 1, "Quartz": 1 }
                },
                "Small Wind Turbine": {
                    icon: "https://i.imgur.com/g0t7V3k.png",
                    recipe: { "Compound": 1, "Aluminum": 1 }
                },
                "Small Generator": {
                    icon: "https://i.imgur.com/P40Hj5x.png",
                    recipe: { "Compound": 1, "Organic": 1 }
                },
                "Packager": {
                    icon: "https://i.imgur.com/D4sT8Vz.png",
                    recipe: { "Graphite": 1 }
                },
                "Small Shredder": {
                    icon: "https://i.imgur.com/T09zKqW.png",
                    recipe: { "Steel": 1 }
                },
                "Drill Mod 1": {
                    icon: "https://i.imgur.com/G4Yt0Lg.png",
                    recipe: { "Titanite": 1 }
                },
                "Drill Mod 2": {
                    icon: "https://i.imgur.com/W2bH6rM.png",
                    recipe: { "Titanite": 1, "Diamond": 1 }
                },
                "Drill Mod 3": {
                    icon: "https://i.imgur.com/W2bH6rM.png",
                    recipe: { "Steel": 1, "Titanium": 1 }
                }
            },
            "Small Printer": {
                "Small Storage": {
                    icon: "https://i.imgur.com/3Z4S0T5.png",
                    recipe: { "Resin": 2 }
                },
                "Medium Storage": {
                    icon: "https://i.imgur.com/uR1d3o8.png",
                    recipe: { "Resin": 2, "Compound": 2 }
                },
                "Medium Solar Panel": {
                    icon: "https://i.imgur.com/8Qp4Z0G.png",
                    recipe: { "Copper": 1, "Glass": 1 }
                },
                "Medium Wind Turbine": {
                    icon: "https://i.imgur.com/8Fk7u9O.png",
                    recipe: { "Aluminum": 1, "Ceramic": 1 }
                },
                "Medium Battery": {
                    icon: "https://i.imgur.com/Xk9v57A.png",
                    recipe: { "Zinc": 1, "Lithium": 1 }
                },
                "Smelting Furnace": {
                    icon: "https://i.imgur.com/4lM3e2T.png",
                    recipe: { "Compound": 2, "Zinc": 1, "Copper": 1 }
                },
                "Research Chamber": {
                    icon: "https://i.imgur.com/A6j4L6p.png",
                    recipe: { "Compound": 1, "Glass": 1, "Graphite": 1 }
                },
                "Chemistry Lab": {
                    icon: "https://i.imgur.com/C30H2aK.png",
                    recipe: { "Tungsten": 1, "Glass": 1, "Ceramic": 1 }
                },
                "Atmospheric Condenser": {
                    icon: "https://i.imgur.com/D9b4m2J.png",
                    recipe: { "Steel": 1, "Glass": 1, "Aluminum": 1 }
                },
                "Trade Platform": {
                    icon: "https://i.imgur.com/lO79C9I.png",
                    recipe: { "Iron": 1, "Compound": 1, "Tungsten": 1 }
                }
            },
            "Medium Printer": {
                "Rover Seat": {
                    icon: "https://i.imgur.com/qB3Z3vP.png",
                    recipe: { "Compound": 1 }
                },
                "Crane": {
                    icon: "https://i.imgur.com/1G6fA6e.png",
                    recipe: { "Iron": 2, "Aluminum": 1 }
                },
                "Winch": {
                    icon: "https://i.imgur.com/7bE9L5l.png",
                    recipe: { "Compound": 1, "Iron": 1 }
                },
                "Vehicle Bay": {
                    icon: "https://i.imgur.com/j1y5V9F.png",
                    recipe: { "Resin": 2, "Compound": 2, "Ceramic": 2 }
                },
                "Solid-Fuel Thruster": {
                    icon: "https://i.imgur.com/L78e4QZ.png",
                    recipe: { "Ammonium": 1, "Iron": 1, "Ceramic": 1 }
                },
                "Hydrazine Thruster": {
                    icon: "https://i.imgur.com/J3D6p8T.png",
                    recipe: { "Tungsten": 1, "Steel": 1 }
                },
                "Small Shuttle": {
                    icon: "https://i.imgur.com/W2d5r9o.png",
                    recipe: { "Aluminum": 2 }
                },
                "Medium Rover": {
                    icon: "https://i.imgur.com/h9D6s6s.png",
                    recipe: { "Titanium": 1, "Iron": 1 }
                }
            },
            "Large Printer": {
                "Large Storage": {
                    icon: "https://i.imgur.com/o5F1h8v.png",
                    recipe: { "Ceramic": 3 }
                },
                "Large Storage Silo": {
                    icon: "https://i.imgur.com/x0R2l4k.png",
                    recipe: { "Aluminum": 2, "Steel": 1 }
                },
                "Shuttle": {
                    icon: "https://i.imgur.com/2p9K0hW.png",
                    recipe: { "Steel": 1, "Nanocarbon Alloy": 1 }
                },
                "Large Rover": {
                    icon: "https://i.imgur.com/8W0m5sZ.png",
                    recipe: { "Titanium": 2, "Steel": 1 }
                },
                "Large Shredder": {
                    icon: "https://i.imgur.com/B7J6u6j.png",
                    recipe: { "Iron": 2, "Nanocarbon Alloy": 1 }
                },
                "Large Rover Seat": {
                    icon: "https://i.imgur.com/J7bH4V5.png",
                    recipe: { "Rubber": 1, "Plastic": 1 }
                },
            },
            "Composite Resources": {
                "Silicone": {
                    icon: "https://i.imgur.com/T0b4u3t.png",
                    recipe: { "Resin": 1, "Quartz": 1, "Methane": 1 }
                },
                "Diamond": {
                    icon: "https://i.imgur.com/E8w9t8f.png",
                    recipe: { "Graphene": 2 }
                },
                "Rubber": {
                    icon: "https://i.imgur.com/H1tW5E3.png",
                    recipe: { "Organic": 1, "Resin": 1 }
                },
                "Plastic": {
                    icon: "https://i.imgur.com/B4j5z8m.png",
                    recipe: { "Compound": 1, "Carbon": 1 }
                },
                "Aluminum Alloy": {
                    icon: "https://i.imgur.com/J5e4o8D.png",
                    recipe: { "Aluminum": 1, "Copper": 1 }
                },
                "Steel": {
                    icon: "https://i.imgur.com/K3n7b9X.png",
                    recipe: { "Iron": 1, "Carbon": 1, "Argon": 1 }
                },
                "Titanium Alloy": {
                    icon: "https://i.imgur.com/M6o9w2f.png",
                    recipe: { "Titanium": 1, "Graphene": 1, "Nitrogen": 1 }
                },
                "Nanocarbon Alloy": {
                    icon: "https://i.imgur.com/F2t5h1c.png",
                    recipe: { "Steel": 1, "Titanium Alloy": 1, "Helium": 1 }
                },
                "Graphene": {
                    icon: "https://i.imgur.com/V7e5s6r.png",
                    recipe: { "Graphite": 1, "Hydrazine": 1 }
                }
            }
        };

        const resourceImages = {
            "Compound": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Compound.webp",
            "Resin": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Resin.webp",
            "Zinc": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Zinc.webp",
            "Lithium": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Lithium.webp",
            "Copper": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Copper.webp",
            "Quartz": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Quartz.webp",
            "Aluminum": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Aluminum.webp",
            "Organic": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Organic.webp",
            "Graphite": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Graphite.webp",
            "Steel": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Steel.webp",
            "Titanite": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Titanite.webp",
            "Diamond": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Diamond.webp",
            "Glass": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Glass.webp",
            "Ceramic": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Ceramic.webp",
            "Tungsten": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Tungsten.webp",
            "Iron": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Iron.webp",
            "Ammonium": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Ammonium.webp",
            "Titanium": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Titanium.webp",
            "Rubber": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Rubber.webp",
            "Plastic": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Plastic.webp",
            "Carbon": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Carbon.webp",
            "Argon": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Argon.webp",
            "Graphene": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Graphene.webp",
            "Nitrogen": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Nitrogen.webp",
            "Helium": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Helium.webp",
            "Hydrazine": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Hydrazine.webp",
            "Methane": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Methane.webp",
            "Aluminum Alloy": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Aluminum_Alloy.webp",
            "Nanocarbon Alloy": "https://raw.githubusercontent.com/Susnugg/astroneer-resource-planner.github.io/main/icons/20px-Icon_Nanocarbon_Alloy.webp"
        };
        

        let selectedItems = new Set();
        let itemQuantities = {};
        const itemListDiv = document.getElementById('itemList');
        const searchInput = document.getElementById('searchInput');
        const resourceListUl = document.getElementById('resourceList');
        const noSelectionMessage = document.getElementById('noSelectionMessage');

        // Function to render the list of items from the allItems object.
        function renderItemList(query = '') {
            itemListDiv.innerHTML = '';
            const lowerCaseQuery = query.toLowerCase();

            for (const category in allItems) {
                const categoryItems = Object.keys(allItems[category]);
                const filteredItems = categoryItems.filter(itemName => itemName.toLowerCase().includes(lowerCaseQuery));

                if (filteredItems.length > 0) {
                    const categoryTitle = document.createElement('h3');
                    categoryTitle.className = "text-md font-bold text-gray-400 mt-4 mb-2";
                    categoryTitle.textContent = category;
                    itemListDiv.appendChild(categoryTitle);

                    filteredItems.forEach(itemName => {
                        const item = allItems[category][itemName];
                        const card = document.createElement('div');
                        const isSelected = selectedItems.has(itemName);
                        // We add a data attribute to make it easy to find this element later
                        card.dataset.itemName = itemName; 
                        card.className = `item-card ${isSelected ? 'selected' : ''}`;
                        
                        card.innerHTML = `
                            <div class="item-icon">
                                <img src="${item.icon}" alt="${itemName}" onerror="this.onerror=null; this.src='https://placehold.co/48x48/0c4a6e/7dd3fc?text=Item';">
                            </div>
                            <div class="flex-grow">
                                <p class="font-bold">${itemName}</p>
                                <p class="text-xs text-gray-400">
                                    ${Object.entries(item.recipe).map(([resource, amount]) => `${amount} ${resource}`).join(', ')}
                                </p>
                            </div>
                            ${isSelected ? `
                                <div class="quantity-controls" onclick="event.stopPropagation()">
                                    <input type="number" min="1" value="${itemQuantities[itemName] || 1}" data-item-name="${itemName}" class="quantity-input" />
                                </div>
                            ` : ''}
                        `;
                        card.onclick = () => toggleSelection(itemName);
                        itemListDiv.appendChild(card);
                    });
                }
            }

            // Add event listeners to the new input fields
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('input', handleQuantityChange);
            });
        }

        // Function to handle quantity change
        function handleQuantityChange(event) {
            const itemName = event.target.dataset.itemName;
            const newQuantity = Math.max(1, parseInt(event.target.value) || 1);
            itemQuantities[itemName] = newQuantity;
            event.target.value = newQuantity; // Ensure the UI reflects the minimum of 1
            calculateTotals();
        }

        // Function to toggle an item's selection and recalculate resources.
        // This function now only updates the single card that was clicked,
        // preventing the "snap" effect caused by a full re-render.
        function toggleSelection(itemName) {
            const card = document.querySelector(`[data-item-name="${itemName}"]`);
            if (!card) return; // Exit if element is not found

            if (selectedItems.has(itemName)) {
                selectedItems.delete(itemName);
                delete itemQuantities[itemName];
                card.classList.remove('selected');
                // Remove the quantity input from the card
                const quantityControls = card.querySelector('.quantity-controls');
                if (quantityControls) quantityControls.remove();

            } else {
                selectedItems.add(itemName);
                itemQuantities[itemName] = 1;
                card.classList.add('selected');

                // Add the quantity input to the card
                const quantityControls = document.createElement('div');
                quantityControls.className = 'quantity-controls';
                quantityControls.setAttribute('onclick', 'event.stopPropagation()');
                quantityControls.innerHTML = `<input type="number" min="1" value="1" data-item-name="${itemName}" class="quantity-input" />`;
                card.appendChild(quantityControls);
                
                // Add event listener to the newly created input
                const newQuantityInput = quantityControls.querySelector('.quantity-input');
                if (newQuantityInput) {
                    newQuantityInput.addEventListener('input', handleQuantityChange);
                }
            }
            calculateTotals();
        }

        // Function to calculate the total resources needed based on selected items.
        function calculateTotals() {
            const totalResources = {};
            if (selectedItems.size === 0) {
                // If nothing is selected, gracefully fade out the list
                updateResourceList({});
                noSelectionMessage.classList.remove('hidden');
                return;
            }

            noSelectionMessage.classList.add('hidden');

            selectedItems.forEach(itemName => {
                // Find the item's recipe, searching through all categories
                let recipe = null;
                for (const category in allItems) {
                    if (allItems[category][itemName]) {
                        recipe = allItems[category][itemName].recipe;
                        break;
                    }
                }

                if (recipe) {
                    const quantity = itemQuantities[itemName] || 1;
                    for (const resource in recipe) {
                        if (totalResources[resource]) {
                            totalResources[resource] += recipe[resource] * quantity;
                        } else {
                            totalResources[resource] = recipe[resource] * quantity;
                        }
                    }
                }
            });

            updateResourceList(totalResources);
        }

        // New function to handle animated updates of the resource list.
        function updateResourceList(newResources) {
            const currentItems = Array.from(resourceListUl.children);
            const newResourceNames = new Set(Object.keys(newResources));
            const existingResourceNames = new Set(currentItems.map(item => item.dataset.resourceName));

            // Fade out and remove old items
            currentItems.forEach(item => {
                const resourceName = item.dataset.resourceName;
                if (!newResourceNames.has(resourceName)) {
                    item.classList.add('resource-list-item-exit');
                    item.addEventListener('animationend', () => {
                        item.remove();
                    }, { once: true });
                }
            });

            // Add or update new items
            let delay = 0;
            for (const resourceName in newResources) {
                const existingItem = document.querySelector(`li[data-resource-name="${resourceName}"]`);
                if (existingItem) {
                    // Update quantity if the item already exists
                    const quantitySpan = existingItem.querySelector('.font-bold');
                    if (quantitySpan) {
                        quantitySpan.textContent = newResources[resourceName];
                    }
                } else {
                    // Create new item and animate it in
                    const li = document.createElement('li');
                    li.dataset.resourceName = resourceName;
                    li.className = "flex items-center justify-between p-3 rounded-lg shadow-inner resource-list-item-enter";
                    li.style.animationDelay = `${delay}s`;

                    const resourceImage = resourceImages[resourceName];
                    
                    li.innerHTML = `
                        <span class="flex items-center">
                            <span class="resource-icon bg-blue-500 text-white">
                                <img src="${resourceImage}" alt="${resourceName}" onerror="this.onerror=null; this.src='https://placehold.co/24x24/3b82f6/ffffff?text=${resourceName.charAt(0)}';">
                            </span>
                            ${resourceName}
                        </span>
                        <span class="font-bold text-lg">${newResources[resourceName]}</span>
                    `;
                    resourceListUl.appendChild(li);
                    delay += 0.05; // Small delay for sequential fade-in
                }
            }
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            renderItemList();
            searchInput.addEventListener('input', () => {
                renderItemList(searchInput.value);
            });
        });
    </script>
</body>
</html>
